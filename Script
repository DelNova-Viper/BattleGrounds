--!strict

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local targetPlayer: Player? = nil
local followEnabled = false
local espEnabled = false
local autoTPEnabled = false
local lowHpTPEnabled = false
local boostEnabled = false
local guiAlive = true

local defaultWalkSpeed = 16
local defaultJumpPower = 50
local baseDistance = 4
local currentDistance = 4
local isPressingKey = false

-- Karakter verilerini kaydet
task.spawn(function()
    if LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            defaultWalkSpeed = hum.WalkSpeed
            defaultJumpPower = hum.JumpPower
        end
    end
end)

-- --- ESP & TARGET LOGIC ---
local espBoxes = {}
local lastAutoTarget: Player? = nil

local function getCharacter(player: Player)
    if not player then return nil end
    local char = player.Character or player.CharacterAdded:Wait()
    return char
end

local function getHRP(player: Player)
    local char = getCharacter(player)
    if not char then return nil end
    return char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
end

local function isAlive(player: Player): boolean
    local char = player.Character
    if not char then return false end
    local hum = char:FindFirstChildOfClass("Humanoid")
    return hum ~= nil and hum.Health > 0
end

local function getPlayerHealth(player: Player): number
    local char = player.Character
    if not char then return 0 end
    local hum = char:FindFirstChildOfClass("Humanoid")
    return hum and hum.Health or 0
end

local function getClosestAlivePlayer(originPos: Vector3): Player?
    local closestPlr: Player? = nil
    local closestDist = math.huge

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and isAlive(plr) then
            local hrp = getHRP(plr)
            if hrp then
                local dist = (hrp.Position - originPos).Magnitude
                if dist < closestDist then
                    closestDist = dist
                    closestPlr = plr
                end
            end
        end
    end
    return closestPlr
end

local function getLowestHealthPlayer(): Player?
    local lowestPlr: Player? = nil
    local lowestHp = math.huge

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and isAlive(plr) then
            local hp = getPlayerHealth(plr)
            if hp > 0 and hp < lowestHp then
                lowestHp = hp
                lowestPlr = plr
            end
        end
    end
    return lowestPlr
end

-- Drawing Library (Executor Specific) Check
local Drawing = Drawing or {new = function() return {Remove = function() end, Visible = false} end}

local function clearESPForPlayer(plr: Player)
    if espBoxes[plr] then
        espBoxes[plr]:Remove()
        espBoxes[plr] = nil
    end
end

local function clearAllESP()
    for plr, box in pairs(espBoxes) do
        box:Remove()
        espBoxes[plr] = nil
    end
end

-- TuÅŸ basma kontrolÃ¼
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    local key = input.KeyCode
    local userInputType = input.UserInputType
    
    if userInputType == Enum.UserInputType.MouseButton1 or
       key == Enum.KeyCode.Q or
       key == Enum.KeyCode.One or
       key == Enum.KeyCode.Two or
       key == Enum.KeyCode.Three or
       key == Enum.KeyCode.Four then
        isPressingKey = true
        currentDistance = 1
    end
end)

UserInputService.InputEnded:Connect(function(input)
    local key = input.KeyCode
    local userInputType = input.UserInputType
    
    if userInputType == Enum.UserInputType.MouseButton1 or
       key == Enum.KeyCode.Q or
       key == Enum.KeyCode.One or
       key == Enum.KeyCode.Two or
       key == Enum.KeyCode.Three or
       key == Enum.KeyCode.Four then
        isPressingKey = false
        currentDistance = baseDistance
    end
end)

-- --- GUI CREATION ---
local function createGui()
    if LocalPlayer.PlayerGui:FindFirstChild("DelNovaViperRefined") then
        LocalPlayer.PlayerGui.DelNovaViperRefined:Destroy()
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "DelNovaViperRefined"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    -- Renk Paleti
    local COLORS = {
        MainBg = Color3.fromRGB(25, 25, 30),
        Header = Color3.fromRGB(35, 35, 40),
        Element = Color3.fromRGB(45, 45, 50),
        Accent = Color3.fromRGB(0, 255, 128),
        Text = Color3.fromRGB(255, 255, 255),
        Red = Color3.fromRGB(255, 60, 60)
    }

    -- 1. Mini Button
    local MiniFrame = Instance.new("Frame")
    MiniFrame.Size = UDim2.new(0, 50, 0, 50)
    MiniFrame.Position = UDim2.new(0.05, 0, 0.1, 0)
    MiniFrame.BackgroundColor3 = COLORS.Header
    MiniFrame.Visible = false
    MiniFrame.Active = true
    MiniFrame.Draggable = true
    MiniFrame.Parent = ScreenGui
    Instance.new("UICorner", MiniFrame).CornerRadius = UDim.new(1, 0)
    
    local MiniStroke = Instance.new("UIStroke")
    MiniStroke.Color = COLORS.Accent
    MiniStroke.Thickness = 2
    MiniStroke.Parent = MiniFrame

    local MiniBtn = Instance.new("TextButton")
    MiniBtn.Size = UDim2.new(1,0,1,0)
    MiniBtn.BackgroundTransparency = 1
    MiniBtn.Text = "âš¡"
    MiniBtn.TextSize = 24
    MiniBtn.TextColor3 = COLORS.Accent
    MiniBtn.Parent = MiniFrame

    task.spawn(function()
        local rot = 0
        while guiAlive do
            if MiniFrame.Visible then
                rot = rot + 2
                MiniFrame.Rotation = rot
            end
            task.wait(0.03)
        end
    end)

    -- 2. Ana Panel
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 320, 0, 500)
    MainFrame.Position = UDim2.new(0.5, -240, 0.5, 19)
    MainFrame.BackgroundColor3 = COLORS.MainBg
    MainFrame.ClipsDescendants = true
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.Parent = ScreenGui
    MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    MainFrame.Size = UDim2.new(0, 0, 0, 0)

    Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 8)
    local MainStroke = Instance.new("UIStroke")
    MainStroke.Color = COLORS.Header
    MainStroke.Thickness = 2
    MainStroke.Parent = MainFrame

    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 40)
    Header.BackgroundColor3 = COLORS.Header
    Header.Parent = MainFrame
    Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 8)
    
    local HeaderFix = Instance.new("Frame")
    HeaderFix.Size = UDim2.new(1, 0, 0, 10)
    HeaderFix.Position = UDim2.new(0, 0, 1, -10)
    HeaderFix.BackgroundColor3 = COLORS.Header
    HeaderFix.BorderSizePixel = 0
    HeaderFix.Parent = Header

    local Title = Instance.new("TextLabel")
    Title.Text = "âš¡ VIPER BATTLEGROUNDS"
    Title.Size = UDim2.new(1, -70, 1, 0)
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.BackgroundTransparency = 1
    Title.TextColor3 = COLORS.Text
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    local function createCtrlBtn(text, color, posOffset, callback)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0, 25, 0, 25)
        btn.Position = UDim2.new(1, posOffset, 0.5, -12.5)
        btn.BackgroundColor3 = color
        btn.Text = text
        btn.Font = Enum.Font.GothamBold
        btn.TextColor3 = COLORS.Text
        btn.Parent = Header
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
        btn.MouseButton1Click:Connect(callback)
        return btn
    end

    createCtrlBtn("-", Color3.fromRGB(80, 80, 80), -65, function()
        local tween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0), BackgroundTransparency = 1})
        tween:Play()
        if MainStroke then TweenService:Create(MainStroke, TweenInfo.new(0.3), {Transparency = 1}):Play() end
        tween.Completed:Wait()
        MainFrame.Visible = false
        MiniFrame.Visible = true
        MiniFrame.Size = UDim2.new(0,0,0,0)
        TweenService:Create(MiniFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 50, 0, 50)}):Play()
    end)

    createCtrlBtn("X", COLORS.Red, -35, function()
        guiAlive = false
        clearAllESP()
        ScreenGui:Destroy()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = defaultWalkSpeed
            LocalPlayer.Character.Humanoid.JumpPower = defaultJumpPower
        end
    end)

    MiniBtn.MouseButton1Click:Connect(function()
        local t = TweenService:Create(MiniFrame, TweenInfo.new(0.3), {Size = UDim2.new(0,0,0,0)})
        t:Play()
        t.Completed:Wait()
        MiniFrame.Visible = false
        MainFrame.Visible = true
        MainFrame.BackgroundTransparency = 0
        if MainStroke then MainStroke.Transparency = 0 end
        TweenService:Create(MainFrame, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 320, 0, 500)}):Play()
    end)
	-- --- SCROLLING CONTENT ---
    local ScrollingFrame = Instance.new("ScrollingFrame")
    ScrollingFrame.Size = UDim2.new(1, -10, 1, -50)
    ScrollingFrame.Position = UDim2.new(0, 5, 0, 45)
    ScrollingFrame.BackgroundTransparency = 1
    ScrollingFrame.BorderSizePixel = 0
    ScrollingFrame.ScrollBarThickness = 4
    ScrollingFrame.ScrollBarImageColor3 = COLORS.Accent
    ScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ScrollingFrame.CanvasSize = UDim2.new(0,0,0,0)
    ScrollingFrame.Parent = MainFrame

    local UIList = Instance.new("UIListLayout")
    UIList.Padding = UDim.new(0, 8)
    UIList.SortOrder = Enum.SortOrder.LayoutOrder
    UIList.Parent = ScrollingFrame

    local UIPadding = Instance.new("UIPadding")
    UIPadding.PaddingLeft = UDim.new(0, 5)
    UIPadding.PaddingRight = UDim.new(0, 5)
    UIPadding.PaddingTop = UDim.new(0, 5)
    UIPadding.PaddingBottom = UDim.new(0, 5)
    UIPadding.Parent = ScrollingFrame

    local function createSectionTitle(text)
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, 0, 0, 25)
        lbl.BackgroundTransparency = 1
        lbl.Text = text
        lbl.TextColor3 = Color3.fromRGB(150, 150, 150)
        lbl.Font = Enum.Font.GothamBold
        lbl.TextSize = 12
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.Parent = ScrollingFrame
    end

    local function createToggle(text, icon, callback)
        local Frame = Instance.new("Frame")
        Frame.Size = UDim2.new(1, 0, 0, 40)
        Frame.BackgroundColor3 = COLORS.Element
        Frame.Parent = ScrollingFrame
        Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)

        local Label = Instance.new("TextLabel")
        Label.Size = UDim2.new(0.7, 0, 1, 0)
        Label.Position = UDim2.new(0, 10, 0, 0)
        Label.BackgroundTransparency = 1
        Label.Text = icon .. "  " .. text
        Label.Font = Enum.Font.GothamSemibold
        Label.TextColor3 = COLORS.Text
        Label.TextSize = 14
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Parent = Frame

        local Toggler = Instance.new("TextButton")
        Toggler.Size = UDim2.new(0, 40, 0, 20)
        Toggler.Position = UDim2.new(1, -50, 0.5, -10)
        Toggler.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        Toggler.Text = ""
        Toggler.Parent = Frame
        local TC = Instance.new("UICorner", Toggler)
        TC.CornerRadius = UDim.new(1, 0)

        local Circle = Instance.new("Frame")
        Circle.Size = UDim2.new(0, 16, 0, 16)
        Circle.Position = UDim2.new(0, 2, 0.5, -8)
        Circle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        Circle.Parent = Toggler
        local CC = Instance.new("UICorner", Circle)
        CC.CornerRadius = UDim.new(1, 0)

        local toggled = false
        Toggler.MouseButton1Click:Connect(function()
            toggled = not toggled
            callback(toggled)
            
            local targetPos = toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
            local targetColor = toggled and COLORS.Accent or Color3.fromRGB(200, 200, 200)
            local targetBg = toggled and Color3.fromRGB(50, 50, 50) or Color3.fromRGB(30, 30, 30)

            TweenService:Create(Circle, TweenInfo.new(0.2), {Position = targetPos, BackgroundColor3 = targetColor}):Play()
            TweenService:Create(Toggler, TweenInfo.new(0.2), {BackgroundColor3 = targetBg}):Play()
        end)
        
        return {
            Set = function(val)
                if val ~= toggled then
                    toggled = val
                    local targetPos = toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                    local targetColor = toggled and COLORS.Accent or Color3.fromRGB(200, 200, 200)
                    TweenService:Create(Circle, TweenInfo.new(0.2), {Position = targetPos, BackgroundColor3 = targetColor}):Play()
                end
            end
        }
    end

    local function createSlider(text, min, max, default)
        local Frame = Instance.new("Frame")
        Frame.Size = UDim2.new(1, 0, 0, 50)
        Frame.BackgroundColor3 = COLORS.Element
        Frame.Parent = ScrollingFrame
        Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)

        local Label = Instance.new("TextLabel")
        Label.Size = UDim2.new(1, -10, 0, 20)
        Label.Position = UDim2.new(0, 10, 0, 5)
        Label.BackgroundTransparency = 1
        Label.Text = text
        Label.TextColor3 = COLORS.Text
        Label.Font = Enum.Font.GothamSemibold
        Label.TextSize = 14
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Parent = Frame

        local ValueLabel = Instance.new("TextLabel")
        ValueLabel.Size = UDim2.new(0, 50, 0, 20)
        ValueLabel.Position = UDim2.new(1, -60, 0, 5)
        ValueLabel.BackgroundTransparency = 1
        ValueLabel.Text = tostring(default)
        ValueLabel.TextColor3 = COLORS.Accent
        ValueLabel.Font = Enum.Font.GothamBold
        ValueLabel.TextSize = 14
        ValueLabel.Parent = Frame

        local SliderBar = Instance.new("Frame")
        SliderBar.Size = UDim2.new(1, -20, 0, 6)
        SliderBar.Position = UDim2.new(0, 10, 0, 35)
        SliderBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        SliderBar.Parent = Frame
        Instance.new("UICorner", SliderBar).CornerRadius = UDim.new(1, 0)

        local Fill = Instance.new("Frame")
        Fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
        Fill.BackgroundColor3 = COLORS.Accent
        Fill.Parent = SliderBar
        Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)

        local Trigger = Instance.new("TextButton")
        Trigger.Size = UDim2.new(1, 0, 1, 0)
        Trigger.BackgroundTransparency = 1
        Trigger.Text = ""
        Trigger.Parent = SliderBar

        local value = default
        local dragging = false

        local function update(input)
            local pos = math.clamp((input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
            TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(pos, 0, 1, 0)}):Play()
            value = math.floor(min + (max - min) * pos)
            ValueLabel.Text = tostring(value)
        end

        Trigger.MouseButton1Down:Connect(function() dragging = true end)
        UserInputService.InputEnded:Connect(function(input) 
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end 
        end)
        UserInputService.InputChanged:Connect(function(input) 
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then update(input) end 
        end)

        return function() return value end
    end

    local function createButton(text, color, callback)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 35)
        btn.BackgroundColor3 = color
        btn.Text = text
        btn.Font = Enum.Font.GothamBold
        btn.TextColor3 = COLORS.Text
        btn.TextSize = 14
        btn.Parent = ScrollingFrame
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

        btn.MouseButton1Click:Connect(callback)

        btn.MouseEnter:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.new(color.R*1.2, color.G*1.2, color.B*1.2)}):Play()
        end)
        btn.MouseLeave:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = color}):Play()
        end)
        
        return btn
    end

    -- --- Ã–ÄžELERÄ° EKLE ---
    createSectionTitle("MAIN SETTINGS")
    
    local followToggle = createToggle("Follow Target", "ðŸ‘¤", function(s) 
        followEnabled = s 
        if s then 
            autoTPEnabled = false
            lowHpTPEnabled = false
        end
    end)
    
    local tpToggle = createToggle("Auto TP (Nearest)", "ðŸŽ¯", function(s) 
        autoTPEnabled = s 
        if s then 
            followEnabled = false
            lowHpTPEnabled = false
            followToggle.Set(false)
        else
            lastAutoTarget = nil
        end
    end)

    local lowHpToggle = createToggle("Low HP TP", "â¤ï¸", function(s)
        lowHpTPEnabled = s
        if s then
            followEnabled = false
            autoTPEnabled = false
            followToggle.Set(false)
        end
    end)

    createToggle("ESP Enabled", "ðŸ‘ï¸", function(s) 
        espEnabled = s 
        if not s then clearAllESP() end
    end)

    createSectionTitle("STATS")
    local getSpeed = createSlider("Walk Speed", 16, 250, 100)
    local getJump = createSlider("Jump Power", 50, 350, 100)

    local boostBtn = createButton("ACTIVATE BOOSTS (V)", COLORS.Element, function() end)

    local function toggleBoosts()
        boostEnabled = not boostEnabled
        if boostEnabled then
            boostBtn.Text = "BOOSTS ACTIVE (V)"
            TweenService:Create(boostBtn, TweenInfo.new(0.3), {BackgroundColor3 = COLORS.Accent, TextColor3 = Color3.fromRGB(0,0,0)}):Play()
        else
            boostBtn.Text = "ACTIVATE BOOSTS (V)"
            TweenService:Create(boostBtn, TweenInfo.new(0.3), {BackgroundColor3 = COLORS.Element, TextColor3 = COLORS.Text}):Play()
            
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.WalkSpeed = defaultWalkSpeed
                LocalPlayer.Character.Humanoid.JumpPower = defaultJumpPower
            end
        end
    end
    
    boostBtn.MouseButton1Click:Connect(toggleBoosts)
    
    UserInputService.InputBegan:Connect(function(i, g)
        if not g and i.KeyCode == Enum.KeyCode.V then toggleBoosts() end
    end)

    createSectionTitle("PLAYER LIST (Select Target)")

    local playerContainer = Instance.new("Frame")
    playerContainer.Size = UDim2.new(1, 0, 0, 0)
    playerContainer.BackgroundTransparency = 1
    playerContainer.AutomaticSize = Enum.AutomaticSize.Y
    playerContainer.Parent = ScrollingFrame

    local plLayout = Instance.new("UIListLayout")
    plLayout.Padding = UDim.new(0, 4)
    plLayout.Parent = playerContainer

    local function refreshPlayers()
        for _, c in pairs(playerContainer:GetChildren()) do
            if c:IsA("TextButton") then c:Destroy() end
        end

        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer then
                local btn = Instance.new("TextButton")
                btn.Size = UDim2.new(1, 0, 0, 35)
                btn.BackgroundColor3 = (targetPlayer == plr) and COLORS.Accent or Color3.fromRGB(35, 35, 40)
                btn.Text = ""
                btn.TextColor3 = (targetPlayer == plr) and Color3.new(0,0,0) or COLORS.Text
                btn.Font = Enum.Font.GothamMedium
                btn.Parent = playerContainer
                Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 4)

                -- Profil resmi
                local avatar = Instance.new("ImageLabel")
                avatar.Size = UDim2.new(0, 28, 0, 28)
                avatar.Position = UDim2.new(0, 4, 0.5, -14)
                avatar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                avatar.Image = Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
                avatar.Parent = btn
                Instance.new("UICorner", avatar).CornerRadius = UDim.new(1, 0)

                -- Ä°sim ve HP
                local nameLabel = Instance.new("TextLabel")
                nameLabel.Size = UDim2.new(1, -40, 1, 0)
                nameLabel.Position = UDim2.new(0, 38, 0, 0)
                nameLabel.BackgroundTransparency = 1
                nameLabel.Text = plr.Name .. (isAlive(plr) and " [HP: " .. math.floor(getPlayerHealth(plr)) .. "]" or " [DEAD]")
                nameLabel.TextColor3 = (targetPlayer == plr) and Color3.new(0,0,0) or COLORS.Text
                nameLabel.Font = Enum.Font.GothamMedium
                nameLabel.TextSize = 13
                nameLabel.TextXAlignment = Enum.TextXAlignment.Left
                nameLabel.Parent = btn

                btn.MouseButton1Click:Connect(function()
                    targetPlayer = plr
                    refreshPlayers()
                end)
            end
        end
    end

    refreshPlayers()
    Players.PlayerAdded:Connect(refreshPlayers)
    Players.PlayerRemoving:Connect(function(p)
        if targetPlayer == p then targetPlayer = nil end
        refreshPlayers()
    end)

    MainFrame.Visible = true
    TweenService:Create(MainFrame, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 320, 0, 500)}):Play()

    -- --- LOOP LOGIC ---
    RunService.RenderStepped:Connect(function()
        if not guiAlive then return end

        local char = LocalPlayer.Character
        if char then
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum and boostEnabled then
                hum.WalkSpeed = getSpeed()
                hum.JumpPower = getJump()
            end
        end

        if lowHpTPEnabled and char then
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then
                local lowHpPlayer = getLowestHealthPlayer()
                if lowHpPlayer then
                    targetPlayer = lowHpPlayer
                end
            end
        end

        if autoTPEnabled and char then
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then
                if (not lastAutoTarget) or (not isAlive(lastAutoTarget)) then
                    lastAutoTarget = getClosestAlivePlayer(hrp.Position)
                end
                targetPlayer = lastAutoTarget
            end
        end

        if (followEnabled or autoTPEnabled or lowHpTPEnabled) and targetPlayer and isAlive(targetPlayer) and char then
            local myHRP = char:FindFirstChild("HumanoidRootPart")
            local tChar = targetPlayer.Character
            local targetHRP = tChar and tChar:FindFirstChild("HumanoidRootPart")

            if myHRP and targetHRP then
                local offset = targetHRP.CFrame.LookVector * -currentDistance
                local downOffset = Vector3.new(0, -1.5, 0)
                local targetPos = targetHRP.Position + offset + downOffset
                myHRP.CFrame = CFrame.new(targetPos, targetHRP.Position)
            end
        end
    end)

    -- ESP Loop
    task.spawn(function()
        while guiAlive do
            if espEnabled then
                for _, plr in ipairs(Players:GetPlayers()) do
                    if plr ~= LocalPlayer and isAlive(plr) and plr.Character then
                        local hrp = plr.Character:FindFirstChild("HumanoidRootPart") or getHRP(plr)
                        if hrp then
                            local vector, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)
                            
                            local box = espBoxes[plr]
                            if not box then
                                box = Drawing.new("Square")
                                box.Thickness = 1.5
                                box.Filled = false
                                espBoxes[plr] = box
                            end

                            if onScreen then
                                box.Visible = true
                                if plr == targetPlayer then
                                    box.Color = Color3.fromRGB(255, 255, 0)
                                    box.Thickness = 2.5
                                else
                                    box.Color = Color3.fromRGB(255, 0, 0)
                                    box.Thickness = 1.5
                                end
                                
                                local dist = (workspace.CurrentCamera.CFrame.Position - hrp.Position).Magnitude
                                local scale = 3000 / math.max(dist, 1)
                                box.Size = Vector2.new(2.5 * scale, 3.5 * scale)
                                box.Position = Vector2.new(vector.X - box.Size.X/2, vector.Y - box.Size.Y/2)
                            else
                                box.Visible = false
                            end
                        else
                            clearESPForPlayer(plr)
                        end
                    else
                        clearESPForPlayer(plr)
                    end
                end
                for plr, _ in pairs(espBoxes) do
                    if not Players:FindFirstChild(plr.Name) then
                        clearESPForPlayer(plr)
                    end
                end
            else
                for _, b in pairs(espBoxes) do b.Visible = false end
            end
            task.wait(0.03)
        end
    end)
end

createGui()
